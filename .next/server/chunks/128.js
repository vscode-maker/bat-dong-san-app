exports.id=128,exports.ids=[128],exports.modules={76780:(a,b,c)=>{"use strict";c.d(b,{u:()=>h});class d{constructor(a){this.config=a,console.log("AppSheet Config:",{appId:a.appId,hasAccessKey:!!a.accessKey,baseUrl:a.baseUrl})}async makeRequest(a,b,c,d){try{let e=`${this.config.baseUrl}${this.config.appId}/tables/${encodeURIComponent(b)}/Action`;console.log(`ðŸ”— AppSheet URL: ${e}`);let f={Action:a,Properties:{},Rows:c?[c]:[]};d&&(f.Properties.Selector=d,console.log(`ðŸ” AppSheet Action request for ${b}:`,{Action:a,Selector:d,URL:e}));let g=await fetch(e,{method:"POST",headers:{applicationAccessKey:this.config.accessKey,"Content-Type":"application/json"},body:JSON.stringify(f)});if(console.log(`ðŸ“¡ AppSheet Response Status: ${g.status} ${g.statusText}`),"Find"===a&&!d&&(404===g.status||400===g.status)){console.log(`âš ï¸ POST /Action failed (${g.status}), trying GET fallback...`);let a=`${this.config.baseUrl}${this.config.appId}/tables/${encodeURIComponent(b)}/data`,c=await fetch(a,{method:"GET",headers:{applicationAccessKey:this.config.accessKey}});if(!c.ok){let a=await c.text().catch(()=>"");throw Error(`AppSheet GET fallback failed: ${c.status} ${c.statusText}
${a}`)}let d=await c.json();return console.log(`âœ… GET fallback successful for ${b}:`,d),d}if(!g.ok){let c=await g.text().catch(()=>"");if(console.error(`âŒ AppSheet POST /Action failed:`,{status:g.status,statusText:g.statusText,body:c,request:f}),"Find"===a&&d){console.log(`ðŸ”„ Selector failed, trying GET all data fallback...`);let a=`${this.config.baseUrl}${this.config.appId}/tables/${encodeURIComponent(b)}/data`,c=await fetch(a,{method:"GET",headers:{applicationAccessKey:this.config.accessKey}});if(c.ok){let a=await c.json();return console.log(`âœ… GET fallback after selector failure:`,a),a}}throw Error(`Lá»—i API: ${g.status} ${g.statusText}${c?`
${c}`:""}`)}let h=g.headers.get("content-type")??"";if(204===g.status||!h.includes("application/json"))return[];let i=await g.json();return console.log(`âœ… AppSheet POST /Action successful for ${b}:`,{method:a,selector:d,rowCount:i?.Rows?.length||i?.length||0,sample:i?.Rows?.[0]||i?.[0]||null}),i?.Rows||i||[]}catch(c){throw console.error(`âŒ Lá»—i khi ${a} dá»¯ liá»‡u tá»« báº£ng ${b}:`,c),c}}async getTableData(a,b){let c="string"==typeof b?b:b?.selector;return c?(console.log(`ðŸ” getTableData with selector: ${c}`),this.makeRequest("Find",a,null,c)):(console.log(`ðŸ” getTableData without selector (get all)`),this.makeRequest("Find",a,null,null))}async getProperties(a){return console.log("getProperties selector:",a),this.makeRequest("Find","Properties",null,a)}async getProperty(a){let b=`Filter(Properties, [id] = "${a}")`;return(await this.makeRequest("Find","Properties",null,b))[0]||null}async createProperty(a){let b={...a,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Properties",b)}}async updateProperty(a,b){let c={id:a,...b,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Properties",c)}}async deleteProperty(a){return{success:!0,data:await this.makeRequest("Delete","Properties",{id:a})}}async getUsers(a){return this.makeRequest("Find","Users",null,a)}async getUser(a){let b=`Filter(Users, [id] = "${a}")`;return(await this.makeRequest("Find","Users",null,b))[0]||null}async createUser(a){let b={...a,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Users",b)}}async updateUser(a,b){let c={id:a,...b,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Users",c)}}async deleteUser(a){return{success:!0,data:await this.makeRequest("Delete","Users",{id:a})}}async getUserFavorites(a){let b=`Filter(Favorites, [user_id] = "${a}")`;return console.log(`â¤ï¸ Getting favorites for user ${a} with selector: ${b}`),this.makeRequest("Find","Favorites",null,b)}async addToFavorites(a,b){let c={id:this.generateId(),user_id:a,property_id:b,created_at:new Date().toISOString()};return console.log(`â¤ï¸ Adding to favorites:`,c),{success:!0,data:await this.makeRequest("Add","Favorites",c)}}async removeFromFavorites(a,b){console.log(`ðŸ’” Finding favorite to remove: user=${a}, property=${b}`);let c=(await this.getUserFavorites(a)).find(a=>a.property_id===b);return c?(console.log(`ðŸ’” Removing favorite:`,c),{success:!0,data:await this.makeRequest("Delete","Favorites",{id:c.id})}):(console.warn(`ðŸ’” Favorite not found for user=${a}, property=${b}`),{success:!1,message:"Favorite not found"})}async getUserSavedFilters(a){let b=`Filter(Saved_Filters, [user_id] = "${a}")`;return this.makeRequest("Find","Saved_Filters",null,b)}async saveFilter(a,b,c){let d={id:this.generateId(),user_id:a,name:b,filters:JSON.stringify(c),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Saved_Filters",d)}}async deleteSavedFilter(a){return{success:!0,data:await this.makeRequest("Delete","Saved_Filters",{id:a})}}async createConsultation(a){let b={...a,id:this.generateId(),status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Consultations",b)}}async getConsultations(a){return this.makeRequest("Find","Consultations",null,a)}async updateConsultationStatus(a,b){let c={id:a,status:b,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Consultations",c)}}async getNews(a){return this.makeRequest("Find","News",null,a)}async getNewsArticle(a){let b=`Filter(News, [id] = "${a}")`;return(await this.makeRequest("Find","News",null,b))[0]||null}async createNews(a){let b={...a,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","News",b)}}async updateNews(a,b){let c={id:a,...b,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","News",c)}}async deleteNews(a){return{success:!0,data:await this.makeRequest("Delete","News",{id:a})}}async trackNewsView(a,b,c){let d={id:this.generateId(),news_id:a,user_id:b||"",ip_address:c||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};try{let a=await this.makeRequest("Add","News_Views",d);return{success:!0,data:a}}catch(a){return console.warn("Failed to track news view:",a),{success:!1,error:a}}}async getProjects(a){return this.makeRequest("Find","Projects",null,a)}async getProject(a){let b=`Filter(Projects, [id] = "${a}")`;return(await this.makeRequest("Find","Projects",null,b))[0]||null}async createProject(a){let b={...a,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Projects",b)}}async updateProject(a,b){let c={id:a,...b,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Projects",c)}}async deleteProject(a){return{success:!0,data:await this.makeRequest("Delete","Projects",{id:a})}}async trackProjectView(a,b,c){let d={id:this.generateId(),project_id:a,user_id:b||"",ip_address:c||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};try{let a=await this.makeRequest("Add","Project_Views",d);return{success:!0,data:a}}catch(a){return console.warn("Failed to track project view:",a),{success:!1,error:a}}}async getPropertyTypes(a){return this.makeRequest("Find","Property_Types",null,a)}async getUserComparisons(a){let b=`Filter(Comparisons, [user_id] = "${a}")`;return this.makeRequest("Find","Comparisons",null,b)}async saveComparison(a,b,c){let d={id:this.generateId(),user_id:a,property_ids:JSON.stringify(b),name:c,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Comparisons",d)}}async trackPropertyView(a,b,c){let d={id:this.generateId(),property_id:a,user_id:b||"",ip_address:c||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Property_Views",d)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static getTableData(a,b){return e.getTableData(a,b)}}let e=new d({appId:process.env.NEXT_PUBLIC_APPSHEET_APP_ID||"",accessKey:process.env.NEXT_PUBLIC_APPSHEET_ACCESS_KEY||"",baseUrl:"https://www.appsheet.com/api/v2/apps/"});class f{static getInstance(){return f.instance||(f.instance=new f),f.instance}logAPICall(a){let b=Error().stack?.split("\n").slice(2,6).join("\n")||"Unknown",c=this.callCounts.get(a)||0;this.callCounts.set(a,c+1);let d=this.callTimes.get(a)||[];d.push(new Date),this.callTimes.set(a,d);let e=this.callStacks.get(a)||[];e.push(b),this.callStacks.set(a,e),c>0?(console.warn(`ðŸš¨ API CALL DUPLICATE: ${a} called ${c+1} times!`),console.warn("Call times:",d.map(a=>a.toISOString())),console.warn("Latest call stack:",b),console.warn("All call stacks:",e)):console.log(`âœ… API CALL: ${a} (first time)`)}getReport(){let a={};return this.callCounts.forEach((b,c)=>{a[c]={count:b,times:this.callTimes.get(c)?.map(a=>a.toISOString())||[],stacks:this.callStacks.get(c)||[]}}),a}reset(){this.callCounts.clear(),this.callTimes.clear(),this.callStacks.clear(),console.log("\uD83D\uDD04 API Monitor reset")}hasDuplicates(){for(let a of this.callCounts.values())if(a>1)return!0;return!1}getDuplicates(){let a=[];return this.callCounts.forEach((b,c)=>{b>1&&a.push(`${c} (${b} times)`)}),a}constructor(){this.callCounts=new Map,this.callTimes=new Map,this.callStacks=new Map}}let g=f.getInstance();class h{static async getAllProperties(){return g.logAPICall("Properties"),await d.getTableData("Properties")}static async getProperty(a){return g.logAPICall(`Properties/${a}`),await d.getRecord("Properties",a)}static async getAllNews(){return g.logAPICall("News"),await d.getTableData("News")}static async getNewsArticle(a){return g.logAPICall(`News/${a}`),await d.getRecord("News",a)}static async getAllProjects(){return g.logAPICall("Projects"),await d.getTableData("Projects")}static async getProject(a){return g.logAPICall(`Projects/${a}`),await d.getRecord("Projects",a)}static async getAllUsers(){return g.logAPICall("Users"),await d.getTableData("Users")}static async getUser(a){return g.logAPICall(`Users/${a}`),await d.getRecord("Users",a)}static async getSpecificUser(a){if(!a)return console.log("âš ï¸ getSpecificUser: No ID provided"),null;g.logAPICall(`Users(id:${a})`);try{console.log(`ðŸ” Attempting to fetch user with ID: "${a}"`),console.log(`ðŸ” Method 1: Using Filter(Users, [id] = "${a}") with correct AppSheet URL`);let b=await d.getTableData("Users",{selector:`Filter(Users, [id] = "${a}")`});if(console.log(`ðŸ“Š Method 1 result:`,b),b&&b.length>0&&b[0].id)return console.log(`âœ… Method 1 success: Found user ${b[0].id}`),b[0];if(console.log(`ðŸ” Method 2: Using Filter(Users, [id] = ${a})`),b=await d.getTableData("Users",{selector:`Filter(Users, [id] = ${a})`}),console.log(`ðŸ“Š Method 2 result:`,b),b&&b.length>0&&b[0].id)return console.log(`âœ… Method 2 success: Found user ${b[0].id}`),b[0];console.log(`ðŸ” Method 3: Getting all users and filtering locally for ID: ${a}`);let c=await d.getTableData("Users");if(console.log(`ðŸ“Š Total users from AppSheet:`,c?.length||0),c&&c.length>0){console.log(`ðŸ“Š Sample user structure:`,c[0]);let b=c.find(b=>!![b.id===a,b.id===String(a),b.user_id===a,b.user_id===String(a),Object.values(b).includes(a),Object.values(b).includes(String(a))].some(Boolean)&&(console.log(`âœ… Found matching user:`,b),!0));if(b)return console.log(`âœ… Method 3 success: User found locally:`,{id:b.id,full_name:b.full_name,email:b.email}),b;{console.warn(`âš ï¸ No user found with ID "${a}" in ${c.length} users`);let b=c.map(a=>({id:a.id,user_id:a.user_id,full_name:a.full_name}));console.log(`ðŸ“Š Available user IDs:`,b)}}else console.warn(`âš ï¸ No users returned from AppSheet API`);console.log(`ðŸ” Method 4: Using mock data fallback for ID: ${a}`);let e={aa1:{id:"aa1",email:"nguyenhoa@gmail.com",full_name:"Nguyá»…n VÄƒn H\xf2a",phone:"909123456",avatar_url:"https://s240-ava-talk.zadn.vn/6/4/d/8/1/240/7b2ca9a3a93e67d632aa8d4511d363de.jpg",user_type:"customer",is_vip:"Y",is_active:"Y",address:"123 ÄÆ°á»ng ABC, Quáº­n 1",city:"Há»“ Ch\xed Minh",created_at:"2024-11-01T00:00:00Z",updated_at:"2025-06-19T00:00:00Z",last_login:"2025-06-20T00:00:00Z"},3:{id:"3",email:"test3@example.com",full_name:"Test User 3",phone:"0901234567",user_type:"customer",is_vip:"FALSE",is_active:"TRUE",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",address:"123 Test Street",city:"Ho Chi Minh",district:"District 1",created_at:"2023-01-15T00:00:00Z",updated_at:"2024-12-24T00:00:00Z",last_login:"2024-12-24T10:30:00Z"},456:{id:"456",email:"nguyen.van.a@example.com",full_name:"Nguyá»…n VÄƒn A",phone:"0901234567",user_type:"customer",is_vip:"TRUE",is_active:"TRUE",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",address:"123 ÄÆ°á»ng Nguyá»…n Huá»‡, PhÆ°á»ng Báº¿n Ngh\xe9",city:"Há»“ Ch\xed Minh",district:"Quáº­n 1",created_at:"2023-01-15T00:00:00Z",updated_at:"2024-12-24T00:00:00Z",last_login:"2024-12-24T10:30:00Z"}};if(e[a])return console.log(`âœ… Method 4 success: Using mock user for ID ${a}`),e[a];return console.warn(`âš ï¸ No user found for ID: ${a} using any method`),null}catch(b){return console.error(`âŒ Error fetching specific user ${a}:`,b),null}}static async getUserFavorites(a){return g.logAPICall(`Favorites(user:${a})`),await e.getUserFavorites(a)}static async toggleFavorite(a,b){if(!a||!b)return console.log("âš ï¸ toggleFavorite: Missing userId or propertyId"),!1;g.logAPICall(`FavoritesToggle(user:${a}, property:${b})`);try{if(console.log(`â¤ï¸ Toggling favorite: user=${a}, property=${b}`),(await h.getUserFavorites(a)).some(a=>a.property_id===b))return console.log(`ðŸ’” Removing from favorites: property=${b}`),await e.removeFromFavorites(a,b),!1;return console.log(`â¤ï¸ Adding to favorites: property=${b}`),await e.addToFavorites(a,b),!0}catch(a){throw console.error(`âŒ Error toggling favorite:`,a),a}}static transformProperties(a){return a.map(a=>h.transformProperty(a))}static transformProperty(a){return{id:a.id||a.property_id,title:a.title||a.property_title||"",description:a.description||"",price:Number(a.price)||0,priceText:h.formatPrice(Number(a.price)||0,a.currency||"VND"),currency:a.currency||"VND",property_type:a.property_type||"",propertyType:a.property_type||"",transaction_type:a.transaction_type||"",type:a.transaction_type||"",bedrooms:Number(a.bedrooms)||0,bathrooms:Number(a.bathrooms)||0,area:Number(a.area)||0,address:a.address||"",location:a.location||a.address||"",district:a.district||"",city:a.city||"",province:a.province||"",latitude:a.latitude?Number(a.latitude):null,longitude:a.longitude?Number(a.longitude):null,direction:a.direction||"",legal_status:a.legal_status||"",legal:a.legal_status||"",images:h.parseImages(a.images),image:h.parseImages(a.images)[0]||"/placeholder.svg?height=200&width=300",features:h.parseFeatures(a.features),status:a.status||"available",created_at:a.created_at||"",updated_at:a.updated_at||"",postedDate:a.created_at||"",owner_id:a.owner_id||"",agent_id:a.agent_id||"",views:Number(a.views)||0,is_featured:"TRUE"===a.is_featured||!0===a.is_featured,is_urgent:"TRUE"===a.is_urgent||!0===a.is_urgent}}static transformNews(a){return a.map(a=>h.transformNewsArticle(a))}static transformNewsArticle(a){return{id:a.id||a.news_id,title:a.title||"",content:a.content||"",excerpt:a.excerpt||a.content?.substring(0,150)+"...",featured_image:a.featured_image||"/placeholder.svg?height=200&width=300",category:a.category||"general",status:a.status||"published",published_at:a.published_at||a.created_at,created_at:a.created_at||"",updated_at:a.updated_at||"",author:a.author||"Admin",tags:h.parseTags(a.tags),views:Number(a.views)||0}}static transformProjects(a){return a.map(a=>h.transformProject(a))}static transformProject(a){let b=a.status||"upcoming";return{id:a.id||a.project_id,title:a.title||a.project_name||"",description:a.description||"",developer:a.developer||"",location:a.location||a.address||"",address:a.address||"",district:a.district||"",city:a.city||"",province:a.province||"",area:Number(a.area)||0,units:Number(a.units)||0,price_from:Number(a.price_from)||0,price_to:Number(a.price_to)||0,priceText:h.formatProjectPrice(a.price_from,a.price_to),launch_date:a.launch_date||"",completion_date:a.completion_date||"",status:b,badge:"selling"===b?"Äang b\xe1n":"upcoming"===b?"Sáº¯p má»Ÿ b\xe1n":"Ä\xe3 b\xe1n háº¿t",badgeColor:"selling"===b?"bg-green-600":"upcoming"===b?"bg-blue-600":"bg-gray-600",images:h.parseImages(a.images),image:h.parseImages(a.images)[0]||"/placeholder.svg?height=300&width=400",features:h.parseFeatures(a.features),amenities:h.parseFeatures(a.amenities),is_featured:"Y"===a.is_featured||"TRUE"===a.is_featured||!0===a.is_featured,created_at:a.created_at||"",updated_at:a.updated_at||"",views:Number(a.views)||0}}static transformUsers(a){return a.map(a=>h.transformUser(a))}static transformUser(a){let b=a.avatar_url||"/placeholder.svg?height=80&width=80";if("string"==typeof b&&b.startsWith("{"))try{let a=JSON.parse(b);b=a.Url||a.url||b,console.log(`ðŸ–¼ï¸ Parsed avatar URL:`,b)}catch(a){console.warn(`âš ï¸ Failed to parse avatar_url JSON:`,b)}return{id:a.id||a.user_id,full_name:a.full_name||a.name||"",email:a.email||"",phone:a.phone||"",avatar_url:b,user_type:a.user_type||"customer",is_vip:"Y"===a.is_vip||"TRUE"===a.is_vip||!0===a.is_vip,is_active:"Y"===a.is_active||"TRUE"===a.is_active||!0===a.is_active,created_at:a.created_at||"",updated_at:a.updated_at||"",last_login:a.last_login||"",address:a.address||"",city:a.city||"",province:a.province||"",vip_expires_at:a.vip_expires_at||""}}static parseImages(a){if(!a)return[];try{if(a.startsWith("["))return JSON.parse(a);return a.split(",").map(a=>a.trim())}catch{return a.split(",").map(a=>a.trim())}}static parseFeatures(a){if(!a)return[];try{if(a.startsWith("["))return JSON.parse(a);return a.split(",").map(a=>a.trim())}catch{return a.split(",").map(a=>a.trim())}}static parseTags(a){if(!a)return[];try{if(a.startsWith("["))return JSON.parse(a);return a.split(",").map(a=>a.trim())}catch{return a.split(",").map(a=>a.trim())}}static formatPrice(a,b="VND"){if(0===a)return"Li\xean há»‡";if("VND"===b)return a>=1e9?`${(a/1e9).toFixed(1)} tá»·`:a>=1e6?`${(a/1e6).toFixed(0)} triá»‡u`:a>=1e3?`${(a/1e3).toFixed(0)}k`:a.toLocaleString("vi-VN");return`${a.toLocaleString()} ${b}`}static formatProjectPrice(a,b){return a||b?a&&!b?`Tá»« ${this.formatPrice(a)}`:!a&&b?`Äáº¿n ${this.formatPrice(b)}`:`${this.formatPrice(a)} - ${this.formatPrice(b)}`:"Li\xean há»‡"}}},78335:()=>{},96487:()=>{}};