"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1410],{1890:(e,t,r)=>{r.d(t,{ToastProvider:()=>g,d:()=>h});var s=r(5155),a=r(2115),l=r(2529),o=r(6132),n=r(2056),i=r(3327),c=r(5229),u=r(7003);let d=(0,a.createContext)(void 0);function g(e){let{children:t}=e,[r,l]=(0,a.useState)([]),o=(0,a.useCallback)(e=>{let t=Math.random().toString(36).substr(2,9),r={...e,id:t};l(e=>[...e,r]),setTimeout(()=>{n(t)},e.duration||5e3)},[]),n=(0,a.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]),i=(0,a.useCallback)((e,t)=>{o({type:"success",title:e,description:t})},[o]),c=(0,a.useCallback)((e,t)=>{o({type:"error",title:e,description:t})},[o]),u=(0,a.useCallback)((e,t)=>{o({type:"warning",title:e,description:t})},[o]),g=(0,a.useCallback)((e,t)=>{o({type:"info",title:e,description:t})},[o]);return(0,s.jsxs)(d.Provider,{value:{toasts:r,addToast:o,removeToast:n,success:i,error:c,warning:u,info:g},children:[t,(0,s.jsx)(f,{toasts:r,removeToast:n})]})}function h(){let e=(0,a.useContext)(d);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e}function f(e){let{toasts:t,removeToast:r}=e;return 0===t.length?null:(0,s.jsx)("div",{className:"fixed top-4 right-4 z-[100] space-y-2 max-w-sm w-full",children:t.map(e=>(0,s.jsx)(v,{toast:e,onRemove:r},e.id))})}function v(e){let{toast:t,onRemove:r}=e;return(0,s.jsx)("div",{className:"\n      bg-white/95 backdrop-blur-xl border border-gray-200/50 ".concat((()=>{switch(t.type){case"success":return"border-l-green-500";case"error":return"border-l-red-500";case"warning":return"border-l-yellow-500";case"info":return"border-l-blue-500"}})()," border-l-4\n      rounded-xl shadow-lg p-4 \n      animate-in slide-in-from-right duration-300\n      hover:shadow-xl transition-all\n    "),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{switch(t.type){case"success":return(0,s.jsx)(l.A,{className:"w-5 h-5 text-green-500"});case"error":return(0,s.jsx)(o.A,{className:"w-5 h-5 text-red-500"});case"warning":return(0,s.jsx)(n.A,{className:"w-5 h-5 text-yellow-500"});case"info":return(0,s.jsx)(i.A,{className:"w-5 h-5 text-blue-500"})}})()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-gray-900 mb-1",children:t.title}),t.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:t.description}),t.action&&(0,s.jsx)(u.$,{size:"sm",variant:"outline",onClick:t.action.onClick,className:"mt-2 h-8 text-xs",children:t.action.label})]}),(0,s.jsx)(u.$,{size:"sm",variant:"ghost",onClick:()=>r(t.id),className:"flex-shrink-0 w-6 h-6 p-0 rounded-full hover:bg-gray-100",children:(0,s.jsx)(c.A,{className:"w-4 h-4 text-gray-400"})})]})})}},3163:(e,t,r)=>{r.d(t,{FavoritesProvider:()=>c,e:()=>u});var s=r(5155),a=r(2115),l=r(1890),o=r(9497),n=r(6977);let i=(0,a.createContext)(void 0);function c(e){let{children:t}=e,{userId:r,loading:c}=(0,o.A)(),[u,d]=(0,a.useState)(new Set),[g,h]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),[m,p]=(0,a.useState)(new Set),_=!!r,{warning:w,success:x,error:b}=(0,l.d)(),S=(0,a.useCallback)(async()=>{if(!r||c){d(new Set),h(!1);return}try{h(!0),v(null),console.log("\uD83D\uDD04 Fetching favorites for user: ".concat(r));let e=(await n.u.getUserFavorites(r)).map(e=>e.property_id).filter(Boolean);d(new Set(e)),console.log("✅ Loaded ".concat(e.length," favorites for user: ").concat(r),e)}catch(e){console.error("❌ Error fetching favorites:",e),v(e instanceof Error?e.message:"Failed to fetch favorites")}finally{h(!1)}},[r,c]);(0,a.useEffect)(()=>{c||S()},[S,c]);let y=(0,a.useCallback)(async e=>{if(!r)return void w("Y\xeau cầu đăng nhập","Vui l\xf2ng th\xeam ?id=YOUR_ID v\xe0o URL để đăng nhập");try{p(t=>new Set(t).add(e));let t=u.has(e);console.log("".concat(t?"\uD83D\uDC94":"❤️"," ").concat(t?"Removing":"Adding"," favorite: ").concat(e));let s=await n.u.toggleFavorite(r,e);d(t=>{let r=new Set(t);return s?r.add(e):r.delete(e),r});let a=s?"Đ\xe3 th\xeam v\xe0o y\xeau th\xedch":"Đ\xe3 bỏ y\xeau th\xedch";x("Th\xe0nh c\xf4ng",a),console.log("✅ ".concat(a,": ").concat(e))}catch(e){console.error("❌ Error toggling favorite:",e),b("Lỗi",e instanceof Error?e.message:"Kh\xf4ng thể cập nhật y\xeau th\xedch")}finally{p(t=>{let r=new Set(t);return r.delete(e),r})}},[r,u,w,x,b]),C=(0,a.useCallback)(e=>m.has(e),[m]),$=(0,a.useCallback)(e=>u.has(e),[u]);return(0,s.jsx)(i.Provider,{value:{favorites:u,loading:g,error:f,hasUser:_,currentUserId:r,isFavorite:$,toggleFavorite:y,isToggling:C,refetch:S},children:t})}function u(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useFavoritesContext must be used within a FavoritesProvider");return e}},4440:(e,t,r)=>{r.d(t,{DataProvider:()=>n,d:()=>i});var s=r(5155),a=r(2115),l=r(7139);let o=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(l.$.getData()),[i,c]=(0,a.useState)(l.$.getLoading()),[u,d]=(0,a.useState)(l.$.getErrors()),[g,h]=(0,a.useState)(l.$.getIsInitialized());(0,a.useEffect)(()=>(console.log("\uD83D\uDD04 DataProvider: Initializing global store..."),l.$.initialize(),l.$.subscribe(()=>{n(l.$.getData()),c(l.$.getLoading()),d(l.$.getErrors()),h(l.$.getIsInitialized())})),[]),(0,a.useEffect)(()=>{let e=()=>{l.$.checkAndLoadUserFromUrl()};return e(),window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]);let f={properties:r.properties,getProperties:e=>l.$.getProperties(e),getProperty:e=>l.$.getProperty(e),refreshProperties:()=>l.$.refreshProperties(),news:r.news,getNews:e=>l.$.getNews(e),getNewsArticle:e=>l.$.getNewsArticle(e),refreshNews:()=>l.$.refreshNews(),projects:r.projects,getProjects:e=>l.$.getProjects(e),getProject:e=>l.$.getProject(e),refreshProjects:()=>l.$.refreshProjects(),users:r.users,getUsers:e=>l.$.getUsers(e),getUser:e=>l.$.getUser(e),getCurrentUser:()=>l.$.getCurrentUser(),getCurrentUserId:()=>l.$.getCurrentUserId(),loading:i,errors:u,isInitialized:g,refreshAll:()=>l.$.refreshAll()};return(0,s.jsx)(o.Provider,{value:f,children:t})}function i(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useData must be used within a DataProvider");return e}},9497:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(2115),a=r(63),l=r(7139);let o="real_estate_user_id",n="real_estate_user_data";function i(){var e;let[t,r]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),g=(0,a.useRouter)(),h=(0,a.useSearchParams)(),f=null!=(e=null==h?void 0:h.get("id"))?e:null;(0,s.useEffect)(()=>l.$.subscribe(()=>{let e=l.$.getCurrentUser(),t=l.$.getCurrentUserId();if(e&&t){let s={id:e.id||e.user_id,email:e.email||"",full_name:e.full_name||e.name||"",phone:e.phone||"",user_type:e.user_type||"customer",is_vip:"Y"===e.is_vip||"TRUE"===e.is_vip||!0===e.is_vip,is_active:"Y"===e.is_active||"TRUE"===e.is_active||!0===e.is_active,avatar_url:e.avatar_url||"/placeholder.svg?height=80&width=80",address:e.address||"",city:e.city||"",district:e.district||"",date_of_birth:e.date_of_birth||"",gender:e.gender||"",occupation:e.occupation||"",created_at:e.created_at||"",updated_at:e.updated_at||"",last_login:e.last_login||"",total_favorites:e.total_favorites||0,total_saved_filters:e.total_saved_filters||0,total_consultations:e.total_consultations||0,vip_expires_at:e.vip_expires_at||null,joinYear:e.created_at?new Date(e.created_at).getFullYear().toString():"2023",isVipActive:"Y"===e.is_vip||"TRUE"===e.is_vip||!0===e.is_vip};c(s),r(t),localStorage.setItem(o,t),localStorage.setItem(n,JSON.stringify(s)),console.log("\uD83D\uDD10 useAuth synced with global store: ".concat(t),s.full_name)}else t||(c(null),r(null))}),[]),(0,s.useEffect)(()=>{let e=localStorage.getItem(o),s=localStorage.getItem(n);if(f&&f!==t)console.log("\uD83D\uDD10 URL user detected: ".concat(f,", letting global store handle it")),localStorage.setItem(o,f),r(f),l.$.checkAndLoadUserFromUrl();else if(e&&s&&!f){e!==t&&r(e);try{let t=JSON.parse(s);i!==t&&c(t),console.log("\uD83D\uDD10 User loaded from cache: ".concat(e),t.full_name)}catch(e){console.error("Error parsing cached user data:",e),localStorage.removeItem(n)}}else f||e||(null!==t&&r(null),null!==i&&c(null),console.log("\uD83D\uDD10 No user found"))},[f]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{d(!1)},100);return()=>clearTimeout(e)},[t]);let v=(0,s.useCallback)(e=>{localStorage.setItem(o,e),r(e),l.$.loadCurrentUser(e),console.log("\uD83D\uDD10 User login initiated: ".concat(e))},[]),m=(0,s.useCallback)(()=>{localStorage.removeItem(o),localStorage.removeItem(n),r(null),c(null),console.log("\uD83D\uDD10 User logged out - cleared all data"),g.push("/")},[g]),p=(0,s.useCallback)(e=>{if(i){let t={...i,...e};c(t),localStorage.setItem(n,JSON.stringify(t)),console.log("\uD83D\uDD04 User data updated:",e)}},[i]),_=(0,s.useCallback)(()=>{t&&(console.log("\uD83D\uDD04 Refreshing user data via global store: ".concat(t)),l.$.refreshCurrentUser())},[t]),w=!!t;return{userId:t,userData:i,loading:u,isAuthenticated:w,login:v,logout:m,updateUserData:p,refreshUserData:_}}}}]);