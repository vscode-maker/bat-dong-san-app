"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7601],{5016:(e,t,r)=>{r.d(t,{cn:()=>i});var s=r(2821),a=r(5889);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}},6977:(e,t,r)=>{r.d(t,{u:()=>c});var s=r(5704);class a{async makeRequest(e,t,r,s){try{var a,i,n;let o="".concat(this.config.baseUrl).concat(this.config.appId,"/tables/").concat(encodeURIComponent(t),"/Action");console.log("\uD83D\uDD17 AppSheet URL: ".concat(o));let c={Action:e,Properties:{},Rows:r?[r]:[]};s&&(c.Properties.Selector=s,console.log("\uD83D\uDD0D AppSheet Action request for ".concat(t,":"),{Action:e,Selector:s,URL:o}));let l=await fetch(o,{method:"POST",headers:{applicationAccessKey:this.config.accessKey,"Content-Type":"application/json"},body:JSON.stringify(c)});if(console.log("\uD83D\uDCE1 AppSheet Response Status: ".concat(l.status," ").concat(l.statusText)),"Find"===e&&!s&&(404===l.status||400===l.status)){console.log("⚠️ POST /Action failed (".concat(l.status,"), trying GET fallback..."));let e="".concat(this.config.baseUrl).concat(this.config.appId,"/tables/").concat(encodeURIComponent(t),"/data"),r=await fetch(e,{method:"GET",headers:{applicationAccessKey:this.config.accessKey}});if(!r.ok){let e=await r.text().catch(()=>"");throw Error("AppSheet GET fallback failed: ".concat(r.status," ").concat(r.statusText,"\n").concat(e))}let s=await r.json();return console.log("✅ GET fallback successful for ".concat(t,":"),s),s}if(!l.ok){let r=await l.text().catch(()=>"");if(console.error("❌ AppSheet POST /Action failed:",{status:l.status,statusText:l.statusText,body:r,request:c}),"Find"===e&&s){console.log("\uD83D\uDD04 Selector failed, trying GET all data fallback...");let e="".concat(this.config.baseUrl).concat(this.config.appId,"/tables/").concat(encodeURIComponent(t),"/data"),r=await fetch(e,{method:"GET",headers:{applicationAccessKey:this.config.accessKey}});if(r.ok){let e=await r.json();return console.log("✅ GET fallback after selector failure:",e),e}}throw Error("Lỗi API: ".concat(l.status," ").concat(l.statusText).concat(r?"\n".concat(r):""))}let u=null!=(n=l.headers.get("content-type"))?n:"";if(204===l.status||!u.includes("application/json"))return[];let d=await l.json();return console.log("✅ AppSheet POST /Action successful for ".concat(t,":"),{method:e,selector:s,rowCount:(null==d||null==(a=d.Rows)?void 0:a.length)||(null==d?void 0:d.length)||0,sample:(null==d||null==(i=d.Rows)?void 0:i[0])||(null==d?void 0:d[0])||null}),(null==d?void 0:d.Rows)||d||[]}catch(r){throw console.error("❌ Lỗi khi ".concat(e," dữ liệu từ bảng ").concat(t,":"),r),r}}async getTableData(e,t){let r="string"==typeof t?t:null==t?void 0:t.selector;return r?(console.log("\uD83D\uDD0D getTableData with selector: ".concat(r)),this.makeRequest("Find",e,null,r)):(console.log("\uD83D\uDD0D getTableData without selector (get all)"),this.makeRequest("Find",e,null,null))}async getProperties(e){return console.log("getProperties selector:",e),this.makeRequest("Find","Properties",null,e)}async getProperty(e){return(await this.makeRequest("Find","Properties",null,'Filter(Properties, [id] = "'.concat(e,'")')))[0]||null}async createProperty(e){let t={...e,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Properties",t)}}async updateProperty(e,t){let r={id:e,...t,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Properties",r)}}async deleteProperty(e){return{success:!0,data:await this.makeRequest("Delete","Properties",{id:e})}}async getUsers(e){return this.makeRequest("Find","Users",null,e)}async getUser(e){return(await this.makeRequest("Find","Users",null,'Filter(Users, [id] = "'.concat(e,'")')))[0]||null}async createUser(e){let t={...e,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Users",t)}}async updateUser(e,t){let r={id:e,...t,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Users",r)}}async deleteUser(e){return{success:!0,data:await this.makeRequest("Delete","Users",{id:e})}}async getUserFavorites(e){let t='Filter(Favorites, [user_id] = "'.concat(e,'")');return console.log("❤️ Getting favorites for user ".concat(e," with selector: ").concat(t)),this.makeRequest("Find","Favorites",null,t)}async addToFavorites(e,t){let r={id:this.generateId(),user_id:e,property_id:t,created_at:new Date().toISOString()};return console.log("❤️ Adding to favorites:",r),{success:!0,data:await this.makeRequest("Add","Favorites",r)}}async removeFromFavorites(e,t){console.log("\uD83D\uDC94 Finding favorite to remove: user=".concat(e,", property=").concat(t));let r=(await this.getUserFavorites(e)).find(e=>e.property_id===t);return r?(console.log("\uD83D\uDC94 Removing favorite:",r),{success:!0,data:await this.makeRequest("Delete","Favorites",{id:r.id})}):(console.warn("\uD83D\uDC94 Favorite not found for user=".concat(e,", property=").concat(t)),{success:!1,message:"Favorite not found"})}async getUserSavedFilters(e){return this.makeRequest("Find","Saved_Filters",null,'Filter(Saved_Filters, [user_id] = "'.concat(e,'")'))}async saveFilter(e,t,r){let s={id:this.generateId(),user_id:e,name:t,filters:JSON.stringify(r),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Saved_Filters",s)}}async deleteSavedFilter(e){return{success:!0,data:await this.makeRequest("Delete","Saved_Filters",{id:e})}}async createConsultation(e){let t={...e,id:this.generateId(),status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Consultations",t)}}async getConsultations(e){return this.makeRequest("Find","Consultations",null,e)}async updateConsultationStatus(e,t){let r={id:e,status:t,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Consultations",r)}}async getNews(e){return this.makeRequest("Find","News",null,e)}async getNewsArticle(e){return(await this.makeRequest("Find","News",null,'Filter(News, [id] = "'.concat(e,'")')))[0]||null}async createNews(e){let t={...e,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","News",t)}}async updateNews(e,t){let r={id:e,...t,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","News",r)}}async deleteNews(e){return{success:!0,data:await this.makeRequest("Delete","News",{id:e})}}async trackNewsView(e,t,r){let s={id:this.generateId(),news_id:e,user_id:t||"",ip_address:r||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};try{let e=await this.makeRequest("Add","News_Views",s);return{success:!0,data:e}}catch(e){return console.warn("Failed to track news view:",e),{success:!1,error:e}}}async getProjects(e){return this.makeRequest("Find","Projects",null,e)}async getProject(e){return(await this.makeRequest("Find","Projects",null,'Filter(Projects, [id] = "'.concat(e,'")')))[0]||null}async createProject(e){let t={...e,id:this.generateId(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Projects",t)}}async updateProject(e,t){let r={id:e,...t,updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Edit","Projects",r)}}async deleteProject(e){return{success:!0,data:await this.makeRequest("Delete","Projects",{id:e})}}async trackProjectView(e,t,r){let s={id:this.generateId(),project_id:e,user_id:t||"",ip_address:r||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};try{let e=await this.makeRequest("Add","Project_Views",s);return{success:!0,data:e}}catch(e){return console.warn("Failed to track project view:",e),{success:!1,error:e}}}async getPropertyTypes(e){return this.makeRequest("Find","Property_Types",null,e)}async getUserComparisons(e){return this.makeRequest("Find","Comparisons",null,'Filter(Comparisons, [user_id] = "'.concat(e,'")'))}async saveComparison(e,t,r){let s={id:this.generateId(),user_id:e,property_ids:JSON.stringify(t),name:r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Comparisons",s)}}async trackPropertyView(e,t,r){let s={id:this.generateId(),property_id:e,user_id:t||"",ip_address:r||"",user_agent:"undefined"!=typeof navigator?navigator.userAgent:"",viewed_at:new Date().toISOString()};return{success:!0,data:await this.makeRequest("Add","Property_Views",s)}}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static getTableData(e,t){return i.getTableData(e,t)}constructor(e){this.config=e,console.log("AppSheet Config:",{appId:e.appId,hasAccessKey:!!e.accessKey,baseUrl:e.baseUrl})}}let i=new a({appId:s.env.NEXT_PUBLIC_APPSHEET_APP_ID||"",accessKey:s.env.NEXT_PUBLIC_APPSHEET_ACCESS_KEY||"",baseUrl:"https://www.appsheet.com/api/v2/apps/"});class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}logAPICall(e){var t;let r=(null==(t=Error().stack)?void 0:t.split("\n").slice(2,6).join("\n"))||"Unknown",s=this.callCounts.get(e)||0;this.callCounts.set(e,s+1);let a=this.callTimes.get(e)||[];a.push(new Date),this.callTimes.set(e,a);let i=this.callStacks.get(e)||[];i.push(r),this.callStacks.set(e,i),s>0?(console.warn("\uD83D\uDEA8 API CALL DUPLICATE: ".concat(e," called ").concat(s+1," times!")),console.warn("Call times:",a.map(e=>e.toISOString())),console.warn("Latest call stack:",r),console.warn("All call stacks:",i)):console.log("✅ API CALL: ".concat(e," (first time)"))}getReport(){let e={};return this.callCounts.forEach((t,r)=>{var s;e[r]={count:t,times:(null==(s=this.callTimes.get(r))?void 0:s.map(e=>e.toISOString()))||[],stacks:this.callStacks.get(r)||[]}}),e}reset(){this.callCounts.clear(),this.callTimes.clear(),this.callStacks.clear(),console.log("\uD83D\uDD04 API Monitor reset")}hasDuplicates(){for(let e of this.callCounts.values())if(e>1)return!0;return!1}getDuplicates(){let e=[];return this.callCounts.forEach((t,r)=>{t>1&&e.push("".concat(r," (").concat(t," times)"))}),e}constructor(){this.callCounts=new Map,this.callTimes=new Map,this.callStacks=new Map}}let o=n.getInstance();window.checkAPICalls=()=>{console.log("\uD83D\uDCCA API Call Report:",o.getReport()),o.hasDuplicates()?(console.warn("\uD83D\uDEA8 DUPLICATE CALLS DETECTED:"),console.warn(o.getDuplicates())):console.log("✅ No duplicate calls detected")},window.resetAPIMonitor=()=>{o.reset()},window.checkDuplicates=()=>{o.hasDuplicates()?console.warn("\uD83D\uDEA8 DUPLICATE CALLS:",o.getDuplicates()):console.log("✅ No duplicates")};class c{static async getAllProperties(){return o.logAPICall("Properties"),await a.getTableData("Properties")}static async getProperty(e){return o.logAPICall("Properties/".concat(e)),await a.getRecord("Properties",e)}static async getAllNews(){return o.logAPICall("News"),await a.getTableData("News")}static async getNewsArticle(e){return o.logAPICall("News/".concat(e)),await a.getRecord("News",e)}static async getAllProjects(){return o.logAPICall("Projects"),await a.getTableData("Projects")}static async getProject(e){return o.logAPICall("Projects/".concat(e)),await a.getRecord("Projects",e)}static async getAllUsers(){return o.logAPICall("Users"),await a.getTableData("Users")}static async getUser(e){return o.logAPICall("Users/".concat(e)),await a.getRecord("Users",e)}static async getSpecificUser(e){if(!e)return console.log("⚠️ getSpecificUser: No ID provided"),null;o.logAPICall("Users(id:".concat(e,")"));try{console.log('\uD83D\uDD0D Attempting to fetch user with ID: "'.concat(e,'"')),console.log('\uD83D\uDD0D Method 1: Using Filter(Users, [id] = "'.concat(e,'") with correct AppSheet URL'));let t=await a.getTableData("Users",{selector:'Filter(Users, [id] = "'.concat(e,'")')});if(console.log("\uD83D\uDCCA Method 1 result:",t),t&&t.length>0&&t[0].id)return console.log("✅ Method 1 success: Found user ".concat(t[0].id)),t[0];if(console.log("\uD83D\uDD0D Method 2: Using Filter(Users, [id] = ".concat(e,")")),t=await a.getTableData("Users",{selector:"Filter(Users, [id] = ".concat(e,")")}),console.log("\uD83D\uDCCA Method 2 result:",t),t&&t.length>0&&t[0].id)return console.log("✅ Method 2 success: Found user ".concat(t[0].id)),t[0];console.log("\uD83D\uDD0D Method 3: Getting all users and filtering locally for ID: ".concat(e));let r=await a.getTableData("Users");if(console.log("\uD83D\uDCCA Total users from AppSheet:",(null==r?void 0:r.length)||0),r&&r.length>0){console.log("\uD83D\uDCCA Sample user structure:",r[0]);let t=r.find(t=>!![t.id===e,t.id===String(e),t.user_id===e,t.user_id===String(e),Object.values(t).includes(e),Object.values(t).includes(String(e))].some(Boolean)&&(console.log("✅ Found matching user:",t),!0));if(t)return console.log("✅ Method 3 success: User found locally:",{id:t.id,full_name:t.full_name,email:t.email}),t;{console.warn('⚠️ No user found with ID "'.concat(e,'" in ').concat(r.length," users"));let t=r.map(e=>({id:e.id,user_id:e.user_id,full_name:e.full_name}));console.log("\uD83D\uDCCA Available user IDs:",t)}}else console.warn("⚠️ No users returned from AppSheet API");console.log("\uD83D\uDD0D Method 4: Using mock data fallback for ID: ".concat(e));let s={aa1:{id:"aa1",email:"nguyenhoa@gmail.com",full_name:"Nguyễn Văn H\xf2a",phone:"909123456",avatar_url:"https://s240-ava-talk.zadn.vn/6/4/d/8/1/240/7b2ca9a3a93e67d632aa8d4511d363de.jpg",user_type:"customer",is_vip:"Y",is_active:"Y",address:"123 Đường ABC, Quận 1",city:"Hồ Ch\xed Minh",created_at:"2024-11-01T00:00:00Z",updated_at:"2025-06-19T00:00:00Z",last_login:"2025-06-20T00:00:00Z"},3:{id:"3",email:"test3@example.com",full_name:"Test User 3",phone:"0901234567",user_type:"customer",is_vip:"FALSE",is_active:"TRUE",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",address:"123 Test Street",city:"Ho Chi Minh",district:"District 1",created_at:"2023-01-15T00:00:00Z",updated_at:"2024-12-24T00:00:00Z",last_login:"2024-12-24T10:30:00Z"},456:{id:"456",email:"nguyen.van.a@example.com",full_name:"Nguyễn Văn A",phone:"0901234567",user_type:"customer",is_vip:"TRUE",is_active:"TRUE",avatar_url:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face",address:"123 Đường Nguyễn Huệ, Phường Bến Ngh\xe9",city:"Hồ Ch\xed Minh",district:"Quận 1",created_at:"2023-01-15T00:00:00Z",updated_at:"2024-12-24T00:00:00Z",last_login:"2024-12-24T10:30:00Z"}};if(s[e])return console.log("✅ Method 4 success: Using mock user for ID ".concat(e)),s[e];return console.warn("⚠️ No user found for ID: ".concat(e," using any method")),null}catch(t){return console.error("❌ Error fetching specific user ".concat(e,":"),t),null}}static async getUserFavorites(e){return o.logAPICall("Favorites(user:".concat(e,")")),await i.getUserFavorites(e)}static async toggleFavorite(e,t){if(!e||!t)return console.log("⚠️ toggleFavorite: Missing userId or propertyId"),!1;o.logAPICall("FavoritesToggle(user:".concat(e,", property:").concat(t,")"));try{if(console.log("❤️ Toggling favorite: user=".concat(e,", property=").concat(t)),(await c.getUserFavorites(e)).some(e=>e.property_id===t))return console.log("\uD83D\uDC94 Removing from favorites: property=".concat(t)),await i.removeFromFavorites(e,t),!1;return console.log("❤️ Adding to favorites: property=".concat(t)),await i.addToFavorites(e,t),!0}catch(e){throw console.error("❌ Error toggling favorite:",e),e}}static transformProperties(e){return e.map(e=>c.transformProperty(e))}static transformProperty(e){return{id:e.id||e.property_id,title:e.title||e.property_title||"",description:e.description||"",price:Number(e.price)||0,priceText:c.formatPrice(Number(e.price)||0,e.currency||"VND"),currency:e.currency||"VND",property_type:e.property_type||"",propertyType:e.property_type||"",transaction_type:e.transaction_type||"",type:e.transaction_type||"",bedrooms:Number(e.bedrooms)||0,bathrooms:Number(e.bathrooms)||0,area:Number(e.area)||0,address:e.address||"",location:e.location||e.address||"",district:e.district||"",city:e.city||"",province:e.province||"",latitude:e.latitude?Number(e.latitude):null,longitude:e.longitude?Number(e.longitude):null,direction:e.direction||"",legal_status:e.legal_status||"",legal:e.legal_status||"",images:c.parseImages(e.images),image:c.parseImages(e.images)[0]||"/placeholder.svg?height=200&width=300",features:c.parseFeatures(e.features),status:e.status||"available",created_at:e.created_at||"",updated_at:e.updated_at||"",postedDate:e.created_at||"",owner_id:e.owner_id||"",agent_id:e.agent_id||"",views:Number(e.views)||0,is_featured:"TRUE"===e.is_featured||!0===e.is_featured,is_urgent:"TRUE"===e.is_urgent||!0===e.is_urgent}}static transformNews(e){return e.map(e=>c.transformNewsArticle(e))}static transformNewsArticle(e){var t;return{id:e.id||e.news_id,title:e.title||"",content:e.content||"",excerpt:e.excerpt||(null==(t=e.content)?void 0:t.substring(0,150))+"...",featured_image:e.featured_image||"/placeholder.svg?height=200&width=300",category:e.category||"general",status:e.status||"published",published_at:e.published_at||e.created_at,created_at:e.created_at||"",updated_at:e.updated_at||"",author:e.author||"Admin",tags:c.parseTags(e.tags),views:Number(e.views)||0}}static transformProjects(e){return e.map(e=>c.transformProject(e))}static transformProject(e){let t=e.status||"upcoming";return{id:e.id||e.project_id,title:e.title||e.project_name||"",description:e.description||"",developer:e.developer||"",location:e.location||e.address||"",address:e.address||"",district:e.district||"",city:e.city||"",province:e.province||"",area:Number(e.area)||0,units:Number(e.units)||0,price_from:Number(e.price_from)||0,price_to:Number(e.price_to)||0,priceText:c.formatProjectPrice(e.price_from,e.price_to),launch_date:e.launch_date||"",completion_date:e.completion_date||"",status:t,badge:"selling"===t?"Đang b\xe1n":"upcoming"===t?"Sắp mở b\xe1n":"Đ\xe3 b\xe1n hết",badgeColor:"selling"===t?"bg-green-600":"upcoming"===t?"bg-blue-600":"bg-gray-600",images:c.parseImages(e.images),image:c.parseImages(e.images)[0]||"/placeholder.svg?height=300&width=400",features:c.parseFeatures(e.features),amenities:c.parseFeatures(e.amenities),is_featured:"Y"===e.is_featured||"TRUE"===e.is_featured||!0===e.is_featured,created_at:e.created_at||"",updated_at:e.updated_at||"",views:Number(e.views)||0}}static transformUsers(e){return e.map(e=>c.transformUser(e))}static transformUser(e){let t=e.avatar_url||"/placeholder.svg?height=80&width=80";if("string"==typeof t&&t.startsWith("{"))try{let e=JSON.parse(t);t=e.Url||e.url||t,console.log("\uD83D\uDDBC️ Parsed avatar URL:",t)}catch(e){console.warn("⚠️ Failed to parse avatar_url JSON:",t)}return{id:e.id||e.user_id,full_name:e.full_name||e.name||"",email:e.email||"",phone:e.phone||"",avatar_url:t,user_type:e.user_type||"customer",is_vip:"Y"===e.is_vip||"TRUE"===e.is_vip||!0===e.is_vip,is_active:"Y"===e.is_active||"TRUE"===e.is_active||!0===e.is_active,created_at:e.created_at||"",updated_at:e.updated_at||"",last_login:e.last_login||"",address:e.address||"",city:e.city||"",province:e.province||"",vip_expires_at:e.vip_expires_at||""}}static parseImages(e){if(!e)return[];try{if(e.startsWith("["))return JSON.parse(e);return e.split(",").map(e=>e.trim())}catch(t){return e.split(",").map(e=>e.trim())}}static parseFeatures(e){if(!e)return[];try{if(e.startsWith("["))return JSON.parse(e);return e.split(",").map(e=>e.trim())}catch(t){return e.split(",").map(e=>e.trim())}}static parseTags(e){if(!e)return[];try{if(e.startsWith("["))return JSON.parse(e);return e.split(",").map(e=>e.trim())}catch(t){return e.split(",").map(e=>e.trim())}}static formatPrice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"VND";if(0===e)return"Li\xean hệ";if("VND"===t)return e>=1e9?"".concat((e/1e9).toFixed(1)," tỷ"):e>=1e6?"".concat((e/1e6).toFixed(0)," triệu"):e>=1e3?"".concat((e/1e3).toFixed(0),"k"):e.toLocaleString("vi-VN");return"".concat(e.toLocaleString()," ").concat(t)}static formatProjectPrice(e,t){return e||t?e&&!t?"Từ ".concat(this.formatPrice(e)):!e&&t?"Đến ".concat(this.formatPrice(t)):"".concat(this.formatPrice(e)," - ").concat(this.formatPrice(t)):"Li\xean hệ"}}},7003:(e,t,r)=>{r.d(t,{$:()=>l});var s=r(5155),a=r(2115),i=r(2467),n=r(3101),o=r(5016);let c=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:l=!1,...u}=e,d=l?i.DX:"button";return(0,s.jsx)(d,{className:(0,o.cn)(c({variant:a,size:n,className:r})),ref:t,...u})});l.displayName="Button"},7139:(e,t,r)=>{r.d(t,{$:()=>i});var s=r(6977);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}notify(){this.subscribers.forEach(e=>e())}getUrlUserId(){return new URLSearchParams(window.location.search).get("id")}async initialize(){if(this.isInitialized){console.log("\uD83D\uDD12 Data already initialized globally, skipping...");let e=this.getUrlUserId();e&&e!==this.currentUserId&&await this.loadCurrentUser(e);return}if(this.isInitializing&&this.initPromise){console.log("⏳ Global initialization in progress, waiting..."),await this.initPromise;return}console.log("\uD83D\uDE80 GLOBAL DATA INITIALIZATION (ONCE AND ONLY ONCE)"),this.isInitializing=!0,this.initPromise=this.performInitialization(),await this.initPromise}async performInitialization(){this.setLoading({...this.loading,global:!0});let e=this.getUrlUserId();console.log("\uD83D\uDD0D Checking URL for user ID: ".concat(e||"none"));let t=[s.u.getAllProperties().catch(e=>(console.error("❌ Error fetching properties:",e),this.setError("properties",e.message),[])),s.u.getAllNews().catch(e=>(console.error("❌ Error fetching news:",e),this.setError("news",e.message),[])),s.u.getAllProjects().catch(e=>(console.error("❌ Error fetching projects:",e),this.setError("projects",e.message),[]))],r=Promise.resolve(null);e?(console.log("\uD83D\uDD0D URL has id=".concat(e,", will load user data")),this.currentUserId=e,r=this.loadUserWithDeduplication(e)):console.log("\uD83D\uDC64 No id parameter in URL, skipping Users API call");try{let[e,s,a,i]=await Promise.all([...t,r]);this.data={properties:e,news:s,projects:a,users:[],currentUser:i},console.log("✅ GLOBAL DATA INITIALIZED SUCCESSFULLY:",{properties:e.length,news:s.length,projects:a.length,currentUser:i?"User ".concat(i.id," (").concat(i.full_name||i.name,")"):"No user"}),this.isInitialized=!0}catch(e){console.error("❌ Global initialization error:",e)}finally{this.setLoading({properties:!1,news:!1,projects:!1,users:!1,currentUser:!1,global:!1}),this.isInitializing=!1}}async loadUserWithDeduplication(e){if(this.userLoadingPromises.has(e))return console.log("⏳ User ".concat(e," already being loaded, waiting for existing promise...")),await this.userLoadingPromises.get(e);let t=this.performUserLoad(e);this.userLoadingPromises.set(e,t);try{return await t}finally{this.userLoadingPromises.delete(e)}}async performUserLoad(e){console.log('\uD83D\uDD0D Loading user data with Filter(Users, [id] = "'.concat(e,'")'));try{let t=await s.u.getSpecificUser(e);return t?console.log("✅ User ".concat(e," loaded successfully:"),t.full_name||t.name||"Unknown"):console.warn("⚠️ No user found for ID: ".concat(e)),t}catch(t){throw console.error("❌ Error loading user ".concat(e,":"),t),t}}async loadCurrentUser(e){if(this.currentUserId===e&&this.data.currentUser)return void console.log("\uD83D\uDD12 User ".concat(e," already loaded and current, skipping..."));if(this.userLoadingPromises.has(e)){console.log("⏳ User ".concat(e," already being loaded, waiting..."));try{let t=await this.userLoadingPromises.get(e);this.currentUserId=e,this.data.currentUser=t,this.notify()}catch(e){this.setError("currentUser",e instanceof Error?e.message:"Failed to load user"),this.data.currentUser=null}return}this.setLoading({...this.loading,currentUser:!0}),this.setError("currentUser",null),this.currentUserId=e;try{let t=await this.loadUserWithDeduplication(e);this.data.currentUser=t,this.notify()}catch(t){console.error("❌ Error loading user ".concat(e,":"),t),this.setError("currentUser",t instanceof Error?t.message:"Failed to load user"),this.data.currentUser=null}finally{this.setLoading({...this.loading,currentUser:!1})}}async checkAndLoadUserFromUrl(){let e=this.getUrlUserId();e&&e!==this.currentUserId?await this.loadCurrentUser(e):!e&&this.currentUserId&&(console.log("\uD83D\uDD04 URL no longer has user ID, clearing current user"),this.currentUserId=null,this.data.currentUser=null,this.userLoadingPromises.clear(),this.notify())}getData(){return this.data}getLoading(){return this.loading}getErrors(){return this.errors}getIsInitialized(){return this.isInitialized}getCurrentUser(){return this.data.currentUser}getCurrentUserId(){return this.currentUserId}setLoading(e){this.loading=e,this.notify()}setError(e,t){this.errors[e]=t,this.notify()}async refreshAll(){console.log("\uD83D\uDD04 Manual refresh: All data"),this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.userLoadingPromises.clear(),await this.initialize()}async refreshCurrentUser(){let e=this.getUrlUserId();if(!e)return void console.log("⚠️ No user ID in URL to refresh");console.log("\uD83D\uDD04 Manual refresh: Current user ".concat(e)),this.currentUserId===e&&(this.currentUserId=null,this.data.currentUser=null),await this.loadCurrentUser(e)}async refreshProperties(){console.log("\uD83D\uDD04 Manual refresh: Properties"),this.setLoading({...this.loading,properties:!0}),this.setError("properties",null);try{let e=await s.u.getAllProperties();this.data.properties=e,this.notify()}catch(e){this.setError("properties",e instanceof Error?e.message:"Failed to fetch properties")}finally{this.setLoading({...this.loading,properties:!1})}}async refreshNews(){console.log("\uD83D\uDD04 Manual refresh: News"),this.setLoading({...this.loading,news:!0}),this.setError("news",null);try{let e=await s.u.getAllNews();this.data.news=e,this.notify()}catch(e){this.setError("news",e instanceof Error?e.message:"Failed to fetch news")}finally{this.setLoading({...this.loading,news:!1})}}async refreshProjects(){console.log("\uD83D\uDD04 Manual refresh: Projects"),this.setLoading({...this.loading,projects:!0}),this.setError("projects",null);try{let e=await s.u.getAllProjects();this.data.projects=e,this.notify()}catch(e){this.setError("projects",e instanceof Error?e.message:"Failed to fetch projects")}finally{this.setLoading({...this.loading,projects:!1})}}getProperties(e){if(!this.isInitialized)return[];if(!e)return s.u.transformProperties(this.data.properties);let t=this.data.properties.filter(t=>{if(e.transactionType&&t.transaction_type!==e.transactionType||e.propertyType&&t.property_type!==e.propertyType||e.minPrice&&Number(t.price)<e.minPrice||e.maxPrice&&Number(t.price)>e.maxPrice||e.district&&t.district!==e.district||e.city&&t.city!==e.city||e.featured&&"TRUE"!==t.is_featured&&!0!==t.is_featured)return!1;if(e.search){let r=e.search.toLowerCase();if(!"".concat(t.title||""," ").concat(t.description||""," ").concat(t.address||"").toLowerCase().includes(r))return!1}return!0});return s.u.transformProperties(t)}getProperty(e){if(!this.isInitialized)return null;let t=this.data.properties.find(t=>t.id===e);return t?s.u.transformProperty(t):null}getNews(e){if(!this.isInitialized)return[];let t=this.data.news.filter(e=>"published"===e.status);if((null==e?void 0:e.category)&&(t=t.filter(t=>t.category===e.category)),null==e?void 0:e.search){let r=e.search.toLowerCase();t=t.filter(e=>"".concat(e.title||""," ").concat(e.content||"").toLowerCase().includes(r))}return t=t.sort((e,t)=>{let r=new Date(e.published_at||e.created_at);return new Date(t.published_at||t.created_at).getTime()-r.getTime()}),(null==e?void 0:e.limit)&&(t=t.slice(0,e.limit)),s.u.transformNews(t)}getNewsArticle(e){if(!this.isInitialized)return null;let t=this.data.news.find(t=>t.id===e);return t?s.u.transformNewsArticle(t):null}getProjects(e){if(!this.isInitialized)return[];let t=this.data.projects;if((null==e?void 0:e.status)&&(t=t.filter(t=>t.status===e.status)),(null==e?void 0:e.featured)&&(t=t.filter(e=>"Y"===e.is_featured||"TRUE"===e.is_featured||!0===e.is_featured)),(null==e?void 0:e.developer)&&(t=t.filter(t=>t.developer===e.developer)),null==e?void 0:e.search){let r=e.search.toLowerCase();t=t.filter(e=>"".concat(e.title||""," ").concat(e.description||""," ").concat(e.developer||"").toLowerCase().includes(r))}return t=t.sort((e,t)=>{let r="Y"===e.is_featured||"TRUE"===e.is_featured||!0===e.is_featured,s="Y"===t.is_featured||"TRUE"===t.is_featured||!0===t.is_featured;if(r&&!s)return -1;if(!r&&s)return 1;let a=new Date(e.launch_date||e.created_at);return new Date(t.launch_date||t.created_at).getTime()-a.getTime()}),(null==e?void 0:e.limit)&&(t=t.slice(0,e.limit)),s.u.transformProjects(t)}getProject(e){if(!this.isInitialized)return null;let t=this.data.projects.find(t=>t.id===e);return t?s.u.transformProject(t):null}getUsers(e){return this.data.currentUser?[s.u.transformUser(this.data.currentUser)]:[]}getUser(e){return this.data.currentUser&&this.data.currentUser.id===e?s.u.transformUser(this.data.currentUser):null}constructor(){this.data={properties:[],news:[],projects:[],users:[],currentUser:null},this.loading={properties:!0,news:!0,projects:!0,users:!1,currentUser:!1,global:!0},this.errors={properties:null,news:null,projects:null,users:null,currentUser:null},this.isInitialized=!1,this.isInitializing=!1,this.initPromise=null,this.subscribers=new Set,this.currentUserId=null,this.userLoadingPromises=new Map}}let i=a.getInstance();i.initialize().catch(console.error),window.globalDataStore=i,window.checkGlobalData=()=>{var e;console.log("\uD83C\uDF0D Global Data Store Status:",{initialized:i.getIsInitialized(),currentUserId:i.getCurrentUserId(),currentUser:(null==(e=i.getCurrentUser())?void 0:e.full_name)||"None",data:i.getData(),loading:i.getLoading(),errors:i.getErrors()})},window.checkUrlUser=()=>{let e=new URLSearchParams(window.location.search).get("id");console.log("\uD83D\uDD0D URL User ID:",e||"none"),e&&i.loadCurrentUser(e)},window.checkUserPromises=()=>{console.log("\uD83D\uDD0D Active User Loading Promises:",i.userLoadingPromises.size)}}}]);